var hardwhere = angular.module('hardwhere', ['ngRoute', 'ngAnimate', 'ngResource']);

hardwhere.config(function($routeProvider) {
    $routeProvider.when('/', {templateUrl: 'app/views/index.html', controller: 'IndexController'});
    $routeProvider.when('/login', {templateUrl: 'app/views/login.html', controller: 'LoginController'});
    $routeProvider.when('/dashboard', {templateUrl: 'app/views/dashboard.html', controller: 'DashboardController'});
    $routeProvider.when('/dashboard/add', {templateUrl: 'app/views/add.html', controller: 'DashboardController'});
    $routeProvider.when('/dashboard/edit', {templateUrl: 'app/views/edit.html', controller: 'DashboardController'});
    $routeProvider.otherwise({redirectTo: '/'})
});

hardwhere.controller('DashboardController', function($scope, apiFactory) {

    // http://assmanapi.azurewebsites.net/api/assettype

    $scope.assets = apiFactory.getAssets();

    $scope.addAsset = function() {
        $scope.assets.push({
            name: $scope.newAsset.name,
            desc: $scope.newAsset.desc,
            serial: $scope.newAsset.serial
        });
    }

    $scope.editAsset = function() {
        $scope.assets.push({
            name: $scope.editAsset.name,
            desc: $scope.editAsset.desc,
            serial: $scope.editAsset.serial
        });
    }

    $scope.deleteAsset = function(id) {
        console.log(id);
        $scope.assets.splice({
            Id: id
        });
    }
});
hardwhere.controller('IndexController', function($scope, apiFactory) {

    // Handle Logins!    

});
hardwhere.factory('apiFactory', function($resource){
    
    // var assets = [
    //     { "id": 1, "AssetTypeId": 1, "Properties": [{"name": "Macbook Pro"}, {"desc": "2013 Apple Macbook Pro"}]},
    //     { "id": 1, "AssetTypeId": 2, "Properties": [{"name": "Macbook Pro"}, {"desc": "2013 Apple Macbook Pro"}]},
    //     { "id": 1, "AssetTypeId": 3, "Properties": [{"name": "Macbook Prols"}, {"desc": "2013 Apple Macbook Pro"}]},
    //     { "id": 1, "AssetTypeId": 1, "Properties": [{"name": "Macbook Pro"}, {"desc": "2013 Apple Macbook Pro"}]}
    // ];

    var factory = {};

    factory.getAssets = function() {

        // AJAX Call?

        // $.ajax({
        //     url: "http://assmanapi.azurewebsites.net/api/assettype/",
        //     headers: {
        //         "Authorization": "Basic " + btoa("kent" + ":" + "iheartacos")
        //     },
        //     type: "Get",

        // });

        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/goodasset');
        var assets = assetManager.query({}, function() { console.log(assets);});
        console.log(assets);
        return assets;

        // $http({
        //     url: "http://assmanapi.azurewebsites.net/api/asset",
        //     method: "GET",
        //     data: {"foo":"bar"}
        // }).success(function(data, status, headers, config) {
        //     assets = data;
        //     //console.log(assets);
        //     return assets;

        // }).error(function(data, status, headers, config) {
        //     status = status;
        //     console.log(status);
        // });
    };

    factory.postAsset = function(asset) {
        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/asset');
        var assets = assetManager.save({}, function() { console.log(allAssets);});
        console.log(assets);
        return assets;
    };

    factory.updateAsset = function(asset) {
        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/asset');
        var assets = assetManager.push({}, function() { console.log(allAssets);});
        console.log(assets);
        return assets;
    };

    factory.deleteAsset = function(asset) {
        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/asset');
        var assets = assetManager.delete({}, function() { console.log(allAssets);});
        console.log(assets);
        return assets;
    };

    return factory;

});
