var hardwhere = angular.module('hardwhere', ['ngRoute', 'ngAnimate', 'ngResource']);

hardwhere.config(function($routeProvider) {
    $routeProvider.when('/', {templateUrl: 'app/views/index.html', controller: 'IndexController'});
    $routeProvider.when('/login', {templateUrl: 'app/views/login.html', controller: 'LoginController'});
    $routeProvider.when('/dashboard', {templateUrl: 'app/views/dashboard.html', controller: 'DashboardController'});
    $routeProvider.when('/dashboard/details/:id', {templateUrl: 'app/views/detail.html', controller: 'DetailController'});
    $routeProvider.when('/dashboard/add/', {templateUrl: 'app/views/add.html', controller: 'AddAssetController'});
    $routeProvider.when('/dashboard/add/:id', {templateUrl: 'app/views/create.html', controller: 'CreateAssetController'});
    $routeProvider.when('/dashboard/edit/:id', {templateUrl: 'app/views/edit.html', controller: 'EditAssetController'});
    $routeProvider.otherwise({redirectTo: '/'})
});

hardwhere.controller('AddAssetController', function($scope, $routeParams, apiFactory) {

    // http://assmanapi.azurewebsites.net/api/assettype
    // http://api.dribbble.com/shots/21603
    $scope.types = apiFactory.getAssetTypes();

    $scope.createNewAsset = apiFactory.getNewAsset($routeParams.Id);

    $scope.addAsset = function() {
        $scope.assets.push({
            name: $scope.newAsset.name,
            desc: $scope.newAsset.desc,
            serial: $scope.newAsset.serial
        });
    }

});
hardwhere.controller('CreateAssetController', function($scope, $routeParams, apiFactory) {

    // http://assmanapi.azurewebsites.net/api/assettype
    // http://api.dribbble.com/shots/21603

    $scope.promise = apiFactory.getNewAsset($routeParams.id);

    $scope.promise.then(function(data) {
        $scope.properties = data;
    });

    $scope.FilterProps = function(data) {
        var result = {};
        angular.forEach(data, function(value, key) {
            if (key != 'Id' && key != 'AssetTypeId')
            {
                result[key] = value;
            }
        });
        return result;
    };

});
hardwhere.controller('DashboardController', function($scope, $routeParams, apiFactory) {

    // http://assmanapi.azurewebsites.net/api/assettype
    // http://api.dribbble.com/shots/21603

    $scope.assets = apiFactory.getAssets();

    $scope.deleteAsset = function(id) {
        console.log(id);
        $scope.assets.splice({
            Id: id
        });
    }

});
hardwhere.controller('DetailController', function($scope, $routeParams, apiFactory) {

    // http://assmanapi.azurewebsites.net/api/assettype
    // http://api.dribbble.com/shots/21603

    $scope.asset = apiFactory.getAsset($routeParams.id);

    $scope.asset.then(function(data) {
        
        $scope.somethingElse = data;

        // $scope.sections = [];

        // for(property in data) {
        //     if(data[property].SectionOrder !== undefined) {
                
        //         var section = {order: data[property].SectionOrder, name: data[property].SectionName};

        //         if($scope.sections.indexOf(section) === -1 ) {
                    
        //             $scope.sections.push(section);
        //         }
        //     }
        // }
        //console.log(sections);

    });

    $scope.editAsset = function() {
        $scope.assets.push({
            name: $scope.editAsset.name,
            desc: $scope.editAsset.desc,
            serial: $scope.editAsset.serial
        });
    }

    $scope.deleteAsset = function(id) {
        console.log(id);
        $scope.assets.splice({
            Id: id
        });
    }



});
hardwhere.controller('EditAssetController', function($scope, $routeParams, apiFactory) {

    // http://assmanapi.azurewebsites.net/api/assettype
    // http://api.dribbble.com/shots/21603

    $scope.types = apiFactory.getAssetTypes();

    $scope.asset = apiFactory.getAsset($routeParams.id);

    $scope.editAsset = function() {
        $scope.assets.push({
            name: $scope.editAsset.name,
            desc: $scope.editAsset.desc,
            serial: $scope.editAsset.serial
        });
    }

    $scope.deleteAsset = function(id) {
        console.log(id);
        $scope.assets.splice({
            Id: id
        });
    }

});
hardwhere.controller('IndexController', function($scope, apiFactory) {

    // Handle Logins!    

});
hardwhere.factory('apiFactory', function($resource, $q){
    
    // http://api.dribbble.com/shots/21603

    // var assets = [
    //     { "id": 1, "AssetTypeId": 1, "Properties": [{"name": "Macbook Pro"}, {"desc": "2013 Apple Macbook Pro"}]},
    //     { "id": 1, "AssetTypeId": 2, "Properties": [{"name": "Macbook Pro"}, {"desc": "2013 Apple Macbook Pro"}]},
    //     { "id": 1, "AssetTypeId": 3, "Properties": [{"name": "Macbook Prols"}, {"desc": "2013 Apple Macbook Pro"}]},
    //     { "id": 1, "AssetTypeId": 1, "Properties": [{"name": "Macbook Pro"}, {"desc": "2013 Apple Macbook Pro"}]}
    // ];

    var factory = {};

    factory.getAssets = function() {
        var deferred = $q.defer();
        var assetManager = $resource('http://hardwhere-api.azurewebsites.net/api/asset');
        var assets = assetManager.query({}, function(data) {
            deferred.resolve(data);
        });
        console.log(assets);
        return assets;

    };

    factory.getAssetTypes = function() {
        var deferred = $q.defer();
        var assetManager = $resource('http://hardwhere-api.azurewebsites.net/api/assettype');
        var assets = assetManager.query({}, function(data) {
            deferred.resolve(data);
        });
        console.log(assets);
        return assets;

    };

    factory.getAsset = function(id) {
        var deferred = $q.defer();
        var assetManager = $resource('http://hardwhere-api.azurewebsites.net/api/asset/:id', {id:'@id'});
        var assets = assetManager.get({id:id}, function(data) {
            deferred.resolve(data);
        });
        console.log(assets);
        //return assets;
        return deferred.promise;
    };

    factory.getNewAsset = function(id) {
        var deferred = $q.defer();
        var assetManager = $resource('http://hardwhere-api.azurewebsites.net/api/createnewasset/:id', {id:'@id'});
        var assets = assetManager.get({id:id}, function(data) {
            deferred.resolve(data);
        });
        console.log(assets);
        return deferred.promise;
    }

    factory.postAsset = function(asset) {
        var deferred = $q.defer();
        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/asset');
        var assets = assetManager.save({}, function() { console.log(allAssets);});
        console.log(assets);
        return assets;
    };

    factory.updateAsset = function(asset) {
        var deferred = $q.defer();
        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/asset');
        var assets = assetManager.push({}, function() { console.log(allAssets);});
        console.log(assets);
        return assets;
    };

    factory.deleteAsset = function(asset) {
        var deferred = $q.defer();
        var assetManager = $resource('http://assmanapi.azurewebsites.net/api/asset');
        var assets = assetManager.delete({}, function() { console.log(allAssets);});
        console.log(assets);
        return assets;
    };

    return factory;

});
